<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE QuasiQuotes #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE ViewPatterns #-}</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-comment">-- | Copyright: (c) 2021-2022 berberman</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- SPDX-License-Identifier: MIT</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- Maintainer: berberman &lt;berberman@yandex.com&gt;</span><span>
</span><span id="line-13"></span><span class="hs-comment">-- Stability: experimental</span><span>
</span><span id="line-14"></span><span class="hs-comment">-- Portability: portable</span><span>
</span><span id="line-15"></span><span class="hs-comment">--</span><span>
</span><span id="line-16"></span><span class="hs-comment">-- This module contains a type class 'ToNixExpr' and some its instances associated with either Haskell</span><span>
</span><span id="line-17"></span><span class="hs-comment">-- primitive types or our &quot;NvFetcher.Types&quot;.</span><span>
</span><span id="line-18"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">NvFetcher.NixExpr</span><span>
</span><span id="line-19"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="NvFetcher.Types.html#NixExpr"><span class="hs-identifier">NixExpr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="NvFetcher.NixExpr.html#ToNixExpr"><span class="hs-identifier">ToNixExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="NvFetcher.NixExpr.html#fetcherToDrv"><span class="hs-identifier">fetcherToDrv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">where</span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Coerce</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">coerce</span></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">HashMap</span></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HMap</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List.NonEmpty</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NE</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromMaybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">NeatInterpolation</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">trimming</span></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NvFetcher.Types.html"><span class="hs-identifier">NvFetcher.Types</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="NvFetcher.Utils.html"><span class="hs-identifier">NvFetcher.Utils</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NvFetcher.Utils.html#quote"><span class="hs-identifier">quote</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="NvFetcher.Utils.html#quoteIfNeeds"><span class="hs-identifier">quoteIfNeeds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="annot"><span class="hs-comment">-- | Types can be converted into nix expr</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">class</span><span> </span><span id="ToNixExpr"><span class="annot"><a href="NvFetcher.NixExpr.html#ToNixExpr"><span class="hs-identifier hs-var">ToNixExpr</span></a></span></span><span> </span><span id="local-6989586621679406991"><span class="annot"><a href="#local-6989586621679406991"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-38"></span><span>  </span><span id="toNixExpr"><span class="annot"><a href="NvFetcher.NixExpr.html#toNixExpr"><span class="hs-identifier hs-type">toNixExpr</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679406991"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="NvFetcher.Types.html#NixExpr"><span class="hs-identifier hs-type">NixExpr</span></a></span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="NvFetcher.NixExpr.html#ToNixExpr"><span class="hs-identifier hs-type">ToNixExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="NvFetcher.Types.html#NixFetcher"><span class="hs-identifier hs-type">NixFetcher</span></a></span><span> </span><span class="annot"><a href="NvFetcher.Types.html#Fetched"><span class="hs-identifier hs-type">Fetched</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-41"></span><span>  </span><span id="local-6989586621679407084"><span class="annot"><span class="annottext">toNixExpr :: NixFetcher 'Fetched -&gt; Text
</span><a href="NvFetcher.NixExpr.html#toNixExpr"><span class="hs-identifier hs-var hs-var hs-var hs-var">toNixExpr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NixFetcher 'Fetched -&gt; Text
</span><a href="NvFetcher.NixExpr.html#nixFetcher"><span class="hs-identifier hs-var">nixFetcher</span></a></span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="NvFetcher.NixExpr.html#ToNixExpr"><span class="hs-identifier hs-type">ToNixExpr</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-44"></span><span>  </span><span id="local-6989586621679407089"><span class="annot"><span class="annottext">toNixExpr :: Bool -&gt; Text
</span><a href="NvFetcher.NixExpr.html#toNixExpr"><span class="hs-identifier hs-var hs-var hs-var hs-var">toNixExpr</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;true&quot;</span></span><span>
</span><span id="line-45"></span><span>  </span><span class="annot"><a href="NvFetcher.NixExpr.html#toNixExpr"><span class="hs-identifier hs-var">toNixExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;false&quot;</span></span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679406993"><span class="annot"><a href="NvFetcher.NixExpr.html#ToNixExpr"><span class="hs-identifier hs-type">ToNixExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406993"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="NvFetcher.NixExpr.html#ToNixExpr"><span class="hs-identifier hs-type">ToNixExpr</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679406993"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-48"></span><span>  </span><span id="local-6989586621679407103"><span class="annot"><span class="annottext">toNixExpr :: [a] -&gt; Text
</span><a href="NvFetcher.NixExpr.html#toNixExpr"><span class="hs-identifier hs-var hs-var hs-var hs-var">toNixExpr</span></a></span></span><span> </span><span id="local-6989586621679407104"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679407104"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; a -&gt; Text) -&gt; Text -&gt; [a] -&gt; Text
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679407106"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407106"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621679407107"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679407107"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407106"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Text
forall a. ToNixExpr a =&gt; a -&gt; Text
</span><a href="NvFetcher.NixExpr.html#toNixExpr"><span class="hs-identifier hs-var">toNixExpr</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679407107"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;[&quot;</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679407104"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; ]&quot;</span></span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679406999"><span class="annot"><a href="NvFetcher.NixExpr.html#ToNixExpr"><span class="hs-identifier hs-type">ToNixExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406999"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="NvFetcher.NixExpr.html#ToNixExpr"><span class="hs-identifier hs-type">ToNixExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NE.NonEmpty</span></span><span> </span><span class="annot"><a href="#local-6989586621679406999"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-51"></span><span>  </span><span id="local-6989586621679407112"><span class="annot"><span class="annottext">toNixExpr :: NonEmpty a -&gt; Text
</span><a href="NvFetcher.NixExpr.html#toNixExpr"><span class="hs-identifier hs-var hs-var hs-var hs-var">toNixExpr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; Text
forall a. ToNixExpr a =&gt; a -&gt; Text
</span><a href="NvFetcher.NixExpr.html#toNixExpr"><span class="hs-identifier hs-var">toNixExpr</span></a></span><span> </span><span class="annot"><span class="annottext">([a] -&gt; Text) -&gt; (NonEmpty a -&gt; [a]) -&gt; NonEmpty a -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty a -&gt; [a]
forall a. NonEmpty a -&gt; [a]
</span><span class="hs-identifier hs-var">NE.toList</span></span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="hs-keyword">instance</span><span> </span><span class="hs-pragma">{-# OVERLAPS</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="NvFetcher.NixExpr.html#ToNixExpr"><span class="hs-identifier hs-type">ToNixExpr</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-54"></span><span>  </span><span id="local-6989586621679407121"><span class="annot"><span class="annottext">toNixExpr :: String -&gt; Text
</span><a href="NvFetcher.NixExpr.html#toNixExpr"><span class="hs-identifier hs-var hs-var hs-var hs-var">toNixExpr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Text) -&gt; (String -&gt; String) -&gt; String -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="NvFetcher.NixExpr.html#ToNixExpr"><span class="hs-identifier hs-type">ToNixExpr</span></a></span><span> </span><span class="annot"><a href="NvFetcher.Types.html#NixExpr"><span class="hs-identifier hs-type">NixExpr</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-57"></span><span>  </span><span id="local-6989586621679407125"><span class="annot"><span class="annottext">toNixExpr :: Text -&gt; Text
</span><a href="NvFetcher.NixExpr.html#toNixExpr"><span class="hs-identifier hs-var hs-var hs-var hs-var">toNixExpr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="NvFetcher.NixExpr.html#ToNixExpr"><span class="hs-identifier hs-type">ToNixExpr</span></a></span><span> </span><span class="annot"><a href="NvFetcher.Types.html#Version"><span class="hs-identifier hs-type">Version</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-60"></span><span>  </span><span id="local-6989586621679407129"><span class="annot"><span class="annottext">toNixExpr :: Version -&gt; Text
</span><a href="NvFetcher.NixExpr.html#toNixExpr"><span class="hs-identifier hs-var hs-var hs-var hs-var">toNixExpr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Version -&gt; Text
forall a b. Coercible a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">coerce</span></span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="annot"><a href="NvFetcher.NixExpr.html#nixFetcher"><span class="hs-identifier hs-type">nixFetcher</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="NvFetcher.Types.html#NixFetcher"><span class="hs-identifier hs-type">NixFetcher</span></a></span><span> </span><span class="annot"><a href="NvFetcher.Types.html#Fetched"><span class="hs-identifier hs-type">Fetched</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="NvFetcher.Types.html#NixExpr"><span class="hs-identifier hs-type">NixExpr</span></a></span><span>
</span><span id="line-63"></span><span id="nixFetcher"><span class="annot"><span class="annottext">nixFetcher :: NixFetcher 'Fetched -&gt; Text
</span><a href="NvFetcher.NixExpr.html#nixFetcher"><span class="hs-identifier hs-var hs-var">nixFetcher</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-64"></span><span>  </span><span class="annot"><a href="NvFetcher.Types.html#FetchGit"><span class="hs-identifier hs-type">FetchGit</span></a></span><span>
</span><span id="line-65"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_sha256 :: forall (k :: FetchStatus). NixFetcher k -&gt; FetchResult Checksum k
</span><a href="NvFetcher.Types.html#_sha256"><span class="hs-identifier hs-var">_sha256</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; Checksum -&gt; Text
forall a b. Coercible a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">coerce</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="NvFetcher.Utils.html#quote"><span class="hs-identifier hs-var">quote</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679407132"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407132"><span class="hs-identifier hs-var">sha256</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span>      </span><span class="annot"><span class="annottext">_rev :: forall (k :: FetchStatus). NixFetcher k -&gt; Version
</span><a href="NvFetcher.Types.html#_rev"><span class="hs-identifier hs-var">_rev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="NvFetcher.Utils.html#quote"><span class="hs-identifier hs-var">quote</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; (Version -&gt; Text) -&gt; Version -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Version -&gt; Text
forall a. ToNixExpr a =&gt; a -&gt; Text
</span><a href="NvFetcher.NixExpr.html#toNixExpr"><span class="hs-identifier hs-var">toNixExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679407134"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407134"><span class="hs-identifier hs-var">rev</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-67"></span><span>      </span><span class="annot"><span class="annottext">_fetchSubmodules :: forall (k :: FetchStatus). NixFetcher k -&gt; Bool
</span><a href="NvFetcher.Types.html#_fetchSubmodules"><span class="hs-identifier hs-var">_fetchSubmodules</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Text
forall a. ToNixExpr a =&gt; a -&gt; Text
</span><a href="NvFetcher.NixExpr.html#toNixExpr"><span class="hs-identifier hs-var">toNixExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679407136"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407136"><span class="hs-identifier hs-var">fetchSubmodules</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-68"></span><span>      </span><span class="annot"><span class="annottext">_deepClone :: forall (k :: FetchStatus). NixFetcher k -&gt; Bool
</span><a href="NvFetcher.Types.html#_deepClone"><span class="hs-identifier hs-var">_deepClone</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Text
forall a. ToNixExpr a =&gt; a -&gt; Text
</span><a href="NvFetcher.NixExpr.html#toNixExpr"><span class="hs-identifier hs-var">toNixExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679407138"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407138"><span class="hs-identifier hs-var">deepClone</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-69"></span><span>      </span><span class="annot"><span class="annottext">_leaveDotGit :: forall (k :: FetchStatus). NixFetcher k -&gt; Bool
</span><a href="NvFetcher.Types.html#_leaveDotGit"><span class="hs-identifier hs-var">_leaveDotGit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Text
forall a. ToNixExpr a =&gt; a -&gt; Text
</span><a href="NvFetcher.NixExpr.html#toNixExpr"><span class="hs-identifier hs-var">toNixExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679407140"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407140"><span class="hs-identifier hs-var">leaveDotGit</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-70"></span><span>      </span><span class="annot"><span class="annottext">_furl :: forall (k :: FetchStatus). NixFetcher k -&gt; Text
</span><a href="NvFetcher.Types.html#_furl"><span class="hs-identifier hs-var">_furl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="NvFetcher.Utils.html#quote"><span class="hs-identifier hs-var">quote</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679407142"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407142"><span class="hs-identifier hs-var">url</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-71"></span><span>      </span><span class="annot"><span class="annottext">_name :: forall (k :: FetchStatus). NixFetcher k -&gt; Maybe Text
</span><a href="NvFetcher.Types.html#_name"><span class="hs-identifier hs-var">_name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Text -&gt; Text
</span><a href="#local-6989586621679407144"><span class="hs-identifier hs-var">nameField</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679407145"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407145"><span class="hs-identifier hs-var">n</span></a></span></span><span>
</span><span id="line-72"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-73"></span><span>      </span><span class="annot"><span class="">[trimming|
          fetchgit {
            url = $url;
            rev = $rev;
            fetchSubmodules = $fetchSubmodules;
            deepClone = $deepClone;
            leaveDotGit = $leaveDotGit;$n
            sha256 = $sha256;
          }
    |]</span></span><span>
</span><span id="line-83"></span><span>  </span><span class="annot"><a href="NvFetcher.Types.html#FetchGitHub"><span class="hs-identifier hs-type">FetchGitHub</span></a></span><span>
</span><span id="line-84"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_sha256 :: forall (k :: FetchStatus). NixFetcher k -&gt; FetchResult Checksum k
</span><a href="NvFetcher.Types.html#_sha256"><span class="hs-identifier hs-var">_sha256</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; Checksum -&gt; Text
forall a b. Coercible a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">coerce</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="NvFetcher.Utils.html#quote"><span class="hs-identifier hs-var">quote</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679407151"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407151"><span class="hs-identifier hs-var">sha256</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-85"></span><span>      </span><span class="annot"><span class="annottext">_rev :: forall (k :: FetchStatus). NixFetcher k -&gt; Version
</span><a href="NvFetcher.Types.html#_rev"><span class="hs-identifier hs-var">_rev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="NvFetcher.Utils.html#quote"><span class="hs-identifier hs-var">quote</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; (Version -&gt; Text) -&gt; Version -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Version -&gt; Text
forall a. ToNixExpr a =&gt; a -&gt; Text
</span><a href="NvFetcher.NixExpr.html#toNixExpr"><span class="hs-identifier hs-var">toNixExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679407152"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407152"><span class="hs-identifier hs-var">rev</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-86"></span><span>      </span><span class="annot"><span class="annottext">_fetchSubmodules :: forall (k :: FetchStatus). NixFetcher k -&gt; Bool
</span><a href="NvFetcher.Types.html#_fetchSubmodules"><span class="hs-identifier hs-var">_fetchSubmodules</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Text
forall a. ToNixExpr a =&gt; a -&gt; Text
</span><a href="NvFetcher.NixExpr.html#toNixExpr"><span class="hs-identifier hs-var">toNixExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679407153"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407153"><span class="hs-identifier hs-var">fetchSubmodules</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-87"></span><span>      </span><span class="annot"><span class="annottext">_deepClone :: forall (k :: FetchStatus). NixFetcher k -&gt; Bool
</span><a href="NvFetcher.Types.html#_deepClone"><span class="hs-identifier hs-var">_deepClone</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Text
forall a. ToNixExpr a =&gt; a -&gt; Text
</span><a href="NvFetcher.NixExpr.html#toNixExpr"><span class="hs-identifier hs-var">toNixExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679407154"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407154"><span class="hs-identifier hs-var">deepClone</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-88"></span><span>      </span><span class="annot"><span class="annottext">_leaveDotGit :: forall (k :: FetchStatus). NixFetcher k -&gt; Bool
</span><a href="NvFetcher.Types.html#_leaveDotGit"><span class="hs-identifier hs-var">_leaveDotGit</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Text
forall a. ToNixExpr a =&gt; a -&gt; Text
</span><a href="NvFetcher.NixExpr.html#toNixExpr"><span class="hs-identifier hs-var">toNixExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679407155"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407155"><span class="hs-identifier hs-var">leaveDotGit</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-89"></span><span>      </span><span class="annot"><span class="annottext">_fowner :: forall (k :: FetchStatus). NixFetcher k -&gt; Text
</span><a href="NvFetcher.Types.html#_fowner"><span class="hs-identifier hs-var">_fowner</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="NvFetcher.Utils.html#quote"><span class="hs-identifier hs-var">quote</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679407157"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407157"><span class="hs-identifier hs-var">owner</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-90"></span><span>      </span><span class="annot"><span class="annottext">_frepo :: forall (k :: FetchStatus). NixFetcher k -&gt; Text
</span><a href="NvFetcher.Types.html#_frepo"><span class="hs-identifier hs-var">_frepo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="NvFetcher.Utils.html#quote"><span class="hs-identifier hs-var">quote</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679407159"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407159"><span class="hs-identifier hs-var">repo</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-91"></span><span>      </span><span class="annot"><span class="annottext">_name :: forall (k :: FetchStatus). NixFetcher k -&gt; Maybe Text
</span><a href="NvFetcher.Types.html#_name"><span class="hs-identifier hs-var">_name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Text -&gt; Text
</span><a href="#local-6989586621679407144"><span class="hs-identifier hs-var">nameField</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679407160"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407160"><span class="hs-identifier hs-var">n</span></a></span></span><span>
</span><span id="line-92"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-93"></span><span>      </span><span class="hs-comment">-- TODO: fix fetchFromGitHub in Nixpkgs so that deepClone and</span><span>
</span><span id="line-94"></span><span>      </span><span class="hs-comment">-- leaveDotGit won't get passed to fetchzip</span><span>
</span><span id="line-95"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407154"><span class="hs-identifier hs-var">deepClone</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;true&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407155"><span class="hs-identifier hs-var">leaveDotGit</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;true&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>        </span><span class="hs-keyword">then</span><span>
</span><span id="line-97"></span><span>          </span><span class="annot"><span class="">[trimming|
               fetchFromGitHub {
                 owner = $owner;
                 repo = $repo;
                 rev = $rev;
                 fetchSubmodules = $fetchSubmodules;
                 deepClone = $deepClone;
                 leaveDotGit = $leaveDotGit;$n
                 sha256 = $sha256;
               }
         |]</span></span><span>
</span><span id="line-108"></span><span>        </span><span class="hs-keyword">else</span><span>
</span><span id="line-109"></span><span>          </span><span class="annot"><span class="">[trimming|
               fetchFromGitHub {
                 owner = $owner;
                 repo = $repo;
                 rev = $rev;
                 fetchSubmodules = $fetchSubmodules;$n
                 sha256 = $sha256;
               }
         |]</span></span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="NvFetcher.Types.html#FetchUrl"><span class="hs-identifier hs-type">FetchUrl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="NvFetcher.Utils.html#quote"><span class="hs-identifier hs-var">quote</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679407163"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407163"><span class="hs-identifier hs-var">url</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Text -&gt; Text
</span><a href="#local-6989586621679407144"><span class="hs-identifier hs-var">nameField</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679407164"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407164"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; Checksum -&gt; Text
forall a b. Coercible a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">coerce</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="NvFetcher.Utils.html#quote"><span class="hs-identifier hs-var">quote</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679407165"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407165"><span class="hs-identifier hs-var">sha256</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-119"></span><span>    </span><span class="annot"><span class="">[trimming|
          fetchurl {
            url = $url;$n
            sha256 = $sha256;
          }
    |]</span></span><span>
</span><span id="line-125"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="NvFetcher.Types.html#FetchTarball"><span class="hs-identifier hs-type">FetchTarball</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="NvFetcher.Utils.html#quote"><span class="hs-identifier hs-var">quote</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679407167"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407167"><span class="hs-identifier hs-var">url</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; Checksum -&gt; Text
forall a b. Coercible a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">coerce</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="NvFetcher.Utils.html#quote"><span class="hs-identifier hs-var">quote</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679407168"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407168"><span class="hs-identifier hs-var">sha256</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-126"></span><span>    </span><span class="annot"><span class="">[trimming|
          fetchTarball {
            url = $url;
            sha256 = $sha256;
          }
    |]</span></span><span>
</span><span id="line-132"></span><span>  </span><span class="annot"><a href="NvFetcher.Types.html#FetchDocker"><span class="hs-identifier hs-type">FetchDocker</span></a></span><span>
</span><span id="line-133"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_imageName :: forall (k :: FetchStatus). NixFetcher k -&gt; Text
</span><a href="NvFetcher.Types.html#_imageName"><span class="hs-identifier hs-var">_imageName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="NvFetcher.Utils.html#quote"><span class="hs-identifier hs-var">quote</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; (Text -&gt; Text) -&gt; Text -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
forall a. ToNixExpr a =&gt; a -&gt; Text
</span><a href="NvFetcher.NixExpr.html#toNixExpr"><span class="hs-identifier hs-var">toNixExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679407171"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407171"><span class="hs-identifier hs-var">imageName</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-134"></span><span>      </span><span class="annot"><span class="annottext">_imageTag :: forall (k :: FetchStatus). NixFetcher k -&gt; Text
</span><a href="NvFetcher.Types.html#_imageTag"><span class="hs-identifier hs-var">_imageTag</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="NvFetcher.Utils.html#quote"><span class="hs-identifier hs-var">quote</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; (Text -&gt; Text) -&gt; Text -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
forall a. ToNixExpr a =&gt; a -&gt; Text
</span><a href="NvFetcher.NixExpr.html#toNixExpr"><span class="hs-identifier hs-var">toNixExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679407173"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407173"><span class="hs-identifier hs-var">imageTag</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-135"></span><span>      </span><span class="annot"><span class="annottext">_imageDigest :: forall (k :: FetchStatus).
NixFetcher k -&gt; FetchResult ContainerDigest k
</span><a href="NvFetcher.Types.html#_imageDigest"><span class="hs-identifier hs-var">_imageDigest</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="NvFetcher.Types.html#ContainerDigest"><span class="hs-identifier hs-type">ContainerDigest</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="NvFetcher.Utils.html#quote"><span class="hs-identifier hs-var">quote</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; (Text -&gt; Text) -&gt; Text -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
forall a. ToNixExpr a =&gt; a -&gt; Text
</span><a href="NvFetcher.NixExpr.html#toNixExpr"><span class="hs-identifier hs-var">toNixExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679407176"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407176"><span class="hs-identifier hs-var">imageDigest</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-136"></span><span>      </span><span class="annot"><span class="annottext">_sha256 :: forall (k :: FetchStatus). NixFetcher k -&gt; FetchResult Checksum k
</span><a href="NvFetcher.Types.html#_sha256"><span class="hs-identifier hs-var">_sha256</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; Checksum -&gt; Text
forall a b. Coercible a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">coerce</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="NvFetcher.Utils.html#quote"><span class="hs-identifier hs-var">quote</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679407177"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407177"><span class="hs-identifier hs-var">sha256</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-137"></span><span>      </span><span class="annot"><span class="annottext">_fos :: forall (k :: FetchStatus). NixFetcher k -&gt; Maybe Text
</span><a href="NvFetcher.Types.html#_fos"><span class="hs-identifier hs-var">_fos</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Text -&gt; Text
</span><a href="#local-6989586621679407179"><span class="hs-identifier hs-var">optionalStr</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;os&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679407180"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407180"><span class="hs-identifier hs-var">os</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-138"></span><span>      </span><span class="annot"><span class="annottext">_farch :: forall (k :: FetchStatus). NixFetcher k -&gt; Maybe Text
</span><a href="NvFetcher.Types.html#_farch"><span class="hs-identifier hs-var">_farch</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Text -&gt; Text
</span><a href="#local-6989586621679407179"><span class="hs-identifier hs-var">optionalStr</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;arch&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679407182"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407182"><span class="hs-identifier hs-var">arch</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-139"></span><span>      </span><span class="annot"><span class="annottext">_finalImageName :: forall (k :: FetchStatus). NixFetcher k -&gt; Maybe Text
</span><a href="NvFetcher.Types.html#_finalImageName"><span class="hs-identifier hs-var">_finalImageName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Text -&gt; Text
</span><a href="#local-6989586621679407179"><span class="hs-identifier hs-var">optionalStr</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;finalImageName&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679407184"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407184"><span class="hs-identifier hs-var">finalImageName</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-140"></span><span>      </span><span class="annot"><span class="annottext">_finalImageTag :: forall (k :: FetchStatus). NixFetcher k -&gt; Maybe Text
</span><a href="NvFetcher.Types.html#_finalImageTag"><span class="hs-identifier hs-var">_finalImageTag</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; (Text -&gt; Text) -&gt; Maybe Text -&gt; Text
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407173"><span class="hs-identifier hs-var">imageTag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="NvFetcher.Utils.html#quote"><span class="hs-identifier hs-var">quote</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; (Text -&gt; Text) -&gt; Text -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
forall a. ToNixExpr a =&gt; a -&gt; Text
</span><a href="NvFetcher.NixExpr.html#toNixExpr"><span class="hs-identifier hs-var">toNixExpr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679407187"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407187"><span class="hs-identifier hs-var">finalImageTag</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-141"></span><span>      </span><span class="annot"><span class="annottext">_tlsVerify :: forall (k :: FetchStatus). NixFetcher k -&gt; Maybe Bool
</span><a href="NvFetcher.Types.html#_tlsVerify"><span class="hs-identifier hs-var">_tlsVerify</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Bool -&gt; Text
forall {a}. ToNixExpr a =&gt; Text -&gt; Maybe a -&gt; Text
</span><a href="#local-6989586621679407189"><span class="hs-identifier hs-var">optionalField</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;tlsVerify&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679407190"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407190"><span class="hs-identifier hs-var">tlsVerify</span></a></span></span><span>
</span><span id="line-142"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-143"></span><span>      </span><span class="annot"><span class="">[trimming|
            dockerTools.pullImage {
              imageName = $imageName;
              imageDigest = $imageDigest;
              sha256 = $sha256;
              finalImageTag = $finalImageTag;$os$arch$finalImageName$tlsVerify
            }
      |]</span></span><span>
</span><span id="line-151"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-152"></span><span>    </span><span id="local-6989586621679407189"><span class="annot"><span class="annottext">optionalField :: Text -&gt; Maybe a -&gt; Text
</span><a href="#local-6989586621679407189"><span class="hs-identifier hs-var hs-var">optionalField</span></a></span></span><span> </span><span id="local-6989586621679407201"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407201"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; (a -&gt; Text) -&gt; Maybe a -&gt; Text
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679407202"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679407202"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407201"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; = &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Text
forall a. ToNixExpr a =&gt; a -&gt; Text
</span><a href="NvFetcher.NixExpr.html#toNixExpr"><span class="hs-identifier hs-var">toNixExpr</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679407202"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;;&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span>    </span><span id="local-6989586621679407179"><span class="annot"><span class="annottext">optionalStr :: Text -&gt; Maybe Text -&gt; Text
</span><a href="#local-6989586621679407179"><span class="hs-identifier hs-var hs-var">optionalStr</span></a></span></span><span> </span><span id="local-6989586621679407206"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407206"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Text -&gt; Text
forall {a}. ToNixExpr a =&gt; Text -&gt; Maybe a -&gt; Text
</span><a href="#local-6989586621679407189"><span class="hs-identifier hs-var">optionalField</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407206"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Text -&gt; Text)
-&gt; (Maybe Text -&gt; Maybe Text) -&gt; Maybe Text -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; Maybe Text -&gt; Maybe Text
forall a b. (a -&gt; b) -&gt; Maybe a -&gt; Maybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="NvFetcher.Utils.html#quote"><span class="hs-identifier hs-var">quote</span></a></span><span>
</span><span id="line-154"></span><span>    </span><span id="local-6989586621679407144"><span class="annot"><span class="annottext">nameField :: Maybe Text -&gt; Text
</span><a href="#local-6989586621679407144"><span class="hs-identifier hs-var hs-var">nameField</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Text -&gt; Text
</span><a href="#local-6989586621679407179"><span class="hs-identifier hs-var">optionalStr</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;name&quot;</span></span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span class="hs-comment">-- | Create a trivial drv that extracts the source from a fetcher</span><span>
</span><span id="line-157"></span><span class="hs-comment">-- TODO: Avoid using @NIX_PATH@</span><span>
</span><span id="line-158"></span><span class="annot"><a href="NvFetcher.NixExpr.html#fetcherToDrv"><span class="hs-identifier hs-type">fetcherToDrv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="NvFetcher.Types.html#NixFetcher"><span class="hs-identifier hs-type">NixFetcher</span></a></span><span> </span><span class="annot"><a href="NvFetcher.Types.html#Fetched"><span class="hs-identifier hs-type">Fetched</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="NvFetcher.Types.html#NixExpr"><span class="hs-identifier hs-type">NixExpr</span></a></span><span>
</span><span id="line-159"></span><span id="fetcherToDrv"><span class="annot"><span class="annottext">fetcherToDrv :: NixFetcher 'Fetched -&gt; Text -&gt; Text
</span><a href="NvFetcher.NixExpr.html#fetcherToDrv"><span class="hs-identifier hs-var hs-var">fetcherToDrv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NixFetcher 'Fetched -&gt; Text
forall a. ToNixExpr a =&gt; a -&gt; Text
</span><a href="NvFetcher.NixExpr.html#toNixExpr"><span class="hs-identifier hs-var">toNixExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679407208"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407208"><span class="hs-identifier hs-var">fetcherExpr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="NvFetcher.Utils.html#quote"><span class="hs-identifier hs-var">quote</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679407209"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407209"><span class="hs-identifier hs-var">drvName</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-160"></span><span>  </span><span class="annot"><span class="">[trimming|
    with import &lt;nixpkgs&gt; { };
    stdenv.mkDerivation {
      name = $drvName;
      src = $fetcherExpr;
      nativeBuildInputs = [ unzip ];
      dontBuild = true;
      installPhase = ''
        mkdir $$out
        cp -r * $$out
      '';
    }
  |]</span></span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span class="hs-comment">-- | nix expr snippet like:</span><span>
</span><span id="line-175"></span><span class="hs-comment">--</span><span>
</span><span id="line-176"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-177"></span><span class="hs-comment">-- feeluown-core = {</span><span>
</span><span id="line-178"></span><span class="hs-comment">--     pname = &quot;feeluown-core&quot;;</span><span>
</span><span id="line-179"></span><span class="hs-comment">--     version = &quot;3.7.7&quot;;</span><span>
</span><span id="line-180"></span><span class="hs-comment">--     src = fetchurl {</span><span>
</span><span id="line-181"></span><span class="hs-comment">--       sha256 = &quot;06d3j39ff9znqxkhp9ly81lcgajkhg30hyqxy2809yn23xixg3x2&quot;;</span><span>
</span><span id="line-182"></span><span class="hs-comment">--       url = &quot;https://pypi.io/packages/source/f/feeluown/feeluown-3.7.7.tar.gz&quot;;</span><span>
</span><span id="line-183"></span><span class="hs-comment">--     };</span><span>
</span><span id="line-184"></span><span class="hs-comment">--     a = &quot;B&quot;;</span><span>
</span><span id="line-185"></span><span class="hs-comment">--   };</span><span>
</span><span id="line-186"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-187"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="NvFetcher.NixExpr.html#ToNixExpr"><span class="hs-identifier hs-type">ToNixExpr</span></a></span><span> </span><span class="annot"><a href="NvFetcher.Types.html#PackageResult"><span class="hs-identifier hs-type">PackageResult</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-188"></span><span>  </span><span id="local-6989586621679407212"><span class="annot"><span class="annottext">toNixExpr :: PackageResult -&gt; Text
</span><a href="NvFetcher.NixExpr.html#toNixExpr"><span class="hs-identifier hs-var hs-var hs-var hs-var">toNixExpr</span></a></span></span><span> </span><span class="annot"><a href="NvFetcher.Types.html#PackageResult"><span class="hs-identifier hs-type">PackageResult</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679407214"><span id="local-6989586621679407215"><span id="local-6989586621679407216"><span id="local-6989586621679407217"><span id="local-6989586621679407218"><span id="local-6989586621679407219"><span id="local-6989586621679407220"><span id="local-6989586621679407221"><span class="annot"><span class="annottext">Maybe (HashMap String (Text, HashMap Text Checksum))
Maybe (HashMap String Text)
Maybe (HashMap Text Text)
Maybe Text
Text
UseStaleVersion
NixFetcher 'Fetched
NvcheckerResult
_prname :: Text
_prversion :: NvcheckerResult
_prfetched :: NixFetcher 'Fetched
_prpassthru :: Maybe (HashMap Text Text)
_prextract :: Maybe (HashMap String Text)
_prcargolock :: Maybe (HashMap String (Text, HashMap Text Checksum))
_prpinned :: UseStaleVersion
_prgitdate :: Maybe Text
_prname :: PackageResult -&gt; Text
_prversion :: PackageResult -&gt; NvcheckerResult
_prfetched :: PackageResult -&gt; NixFetcher 'Fetched
_prpassthru :: PackageResult -&gt; Maybe (HashMap Text Text)
_prextract :: PackageResult -&gt; Maybe (HashMap String Text)
_prcargolock :: PackageResult
-&gt; Maybe (HashMap String (Text, HashMap Text Checksum))
_prpinned :: PackageResult -&gt; UseStaleVersion
_prgitdate :: PackageResult -&gt; Maybe Text
</span><a href="#local-6989586621679407214"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-189"></span><span>    </span><span class="annot"><span class="">[trimming|
        $name = {
          pname = $nameString;
          version = $version;
          src = $src;$appending
        };
    |]</span></span><span>
</span><span id="line-196"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-197"></span><span>      </span><span id="local-6989586621679407230"><span class="annot"><span class="annottext">name :: Text
</span><a href="#local-6989586621679407230"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="NvFetcher.Utils.html#quoteIfNeeds"><span class="hs-identifier hs-var">quoteIfNeeds</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407214"><span class="hs-identifier hs-var">_prname</span></a></span><span>
</span><span id="line-198"></span><span>      </span><span id="local-6989586621679407231"><span class="annot"><span class="annottext">nameString :: Text
</span><a href="#local-6989586621679407231"><span class="hs-identifier hs-var hs-var">nameString</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="NvFetcher.Utils.html#quote"><span class="hs-identifier hs-var">quote</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407214"><span class="hs-identifier hs-var">_prname</span></a></span><span>
</span><span id="line-199"></span><span>      </span><span id="local-6989586621679407232"><span class="annot"><span class="annottext">version :: Text
</span><a href="#local-6989586621679407232"><span class="hs-identifier hs-var hs-var">version</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="NvFetcher.Utils.html#quote"><span class="hs-identifier hs-var">quote</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text)
-&gt; (NvcheckerResult -&gt; Text) -&gt; NvcheckerResult -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Version -&gt; Text
forall a b. Coercible a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">coerce</span></span><span> </span><span class="annot"><span class="annottext">(Version -&gt; Text)
-&gt; (NvcheckerResult -&gt; Version) -&gt; NvcheckerResult -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NvcheckerResult -&gt; Version
</span><a href="NvFetcher.Types.html#nvNow"><span class="hs-identifier hs-var">nvNow</span></a></span><span> </span><span class="annot"><span class="annottext">(NvcheckerResult -&gt; Text) -&gt; NvcheckerResult -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NvcheckerResult
</span><a href="#local-6989586621679407215"><span class="hs-identifier hs-var">_prversion</span></a></span><span>
</span><span id="line-200"></span><span>      </span><span id="local-6989586621679407233"><span class="annot"><span class="annottext">src :: Text
</span><a href="#local-6989586621679407233"><span class="hs-identifier hs-var hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NixFetcher 'Fetched -&gt; Text
forall a. ToNixExpr a =&gt; a -&gt; Text
</span><a href="NvFetcher.NixExpr.html#toNixExpr"><span class="hs-identifier hs-var">toNixExpr</span></a></span><span> </span><span class="annot"><span class="annottext">NixFetcher 'Fetched
</span><a href="#local-6989586621679407216"><span class="hs-identifier hs-var">_prfetched</span></a></span><span>
</span><span id="line-201"></span><span>      </span><span id="local-6989586621679407244"><span class="annot"><span class="annottext">extract :: Text
</span><a href="#local-6989586621679407244"><span class="hs-identifier hs-var hs-var">extract</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-202"></span><span>        </span><span class="annot"><span class="annottext">Text
-&gt; (HashMap String Text -&gt; Text)
-&gt; Maybe (HashMap String Text)
-&gt; Text
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span>
</span><span id="line-203"></span><span>          </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-204"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679407245"><span class="annot"><span class="annottext">HashMap String Text
</span><a href="#local-6989586621679407245"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-205"></span><span>              </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.unlines</span></span><span>
</span><span id="line-206"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="NvFetcher.Utils.html#quoteIfNeeds"><span class="hs-identifier hs-var">quoteIfNeeds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679407247"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span>                    </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; = builtins.readFile &quot;</span></span><span>
</span><span id="line-208"></span><span>                    </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407248"><span class="hs-identifier hs-var">fp</span></a></span><span>
</span><span id="line-209"></span><span>                    </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;;&quot;</span></span><span>
</span><span id="line-210"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679407247"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679407247"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679407248"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407248"><span class="hs-identifier hs-var">fp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashMap String Text -&gt; [(String, Text)]
forall k v. HashMap k v -&gt; [(k, v)]
</span><span class="hs-identifier hs-var">HMap.toList</span></span><span> </span><span class="annot"><span class="annottext">HashMap String Text
</span><a href="#local-6989586621679407245"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-211"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-212"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-213"></span><span>          </span><span class="annot"><span class="annottext">Maybe (HashMap String Text)
</span><a href="#local-6989586621679407218"><span class="hs-identifier hs-var">_prextract</span></a></span><span>
</span><span id="line-214"></span><span>      </span><span id="local-6989586621679407257"><span class="annot"><span class="annottext">cargo :: Text
</span><a href="#local-6989586621679407257"><span class="hs-identifier hs-var hs-var">cargo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Text -&gt; Text
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Text -&gt; Text) -&gt; Maybe Text -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-215"></span><span>        </span><span id="local-6989586621679407258"><span class="annot"><span class="annottext">HashMap String (Text, HashMap Text Checksum)
</span><a href="#local-6989586621679407258"><span class="hs-identifier hs-var">cargoLocks</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (HashMap String (Text, HashMap Text Checksum))
</span><a href="#local-6989586621679407219"><span class="hs-identifier hs-var">_prcargolock</span></a></span><span>
</span><span id="line-216"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679407265"><span class="annot"><span class="annottext">depsSnippet :: HashMap Text Checksum -&gt; Text
</span><a href="#local-6989586621679407265"><span class="hs-identifier hs-var hs-var">depsSnippet</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679407266"><span class="annot"><span class="annottext">HashMap Text Checksum
</span><a href="#local-6989586621679407266"><span class="hs-identifier hs-var">deps</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><a href="NvFetcher.Types.html#Checksum"><span class="hs-identifier hs-type">Checksum</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-217"></span><span>              </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.unlines</span></span><span>
</span><span id="line-218"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="NvFetcher.Utils.html#quoteIfNeeds"><span class="hs-identifier hs-var">quoteIfNeeds</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407267"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-219"></span><span>                    </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; = &quot;</span></span><span>
</span><span id="line-220"></span><span>                    </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="NvFetcher.Utils.html#quote"><span class="hs-identifier hs-var">quote</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Checksum -&gt; Text
forall a b. Coercible a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">coerce</span></span><span> </span><span class="annot"><span class="annottext">Checksum
</span><a href="#local-6989586621679407268"><span class="hs-identifier hs-var">sum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-221"></span><span>                    </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;;&quot;</span></span><span>
</span><span id="line-222"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679407267"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407267"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679407268"><span class="annot"><span class="annottext">Checksum
</span><a href="#local-6989586621679407268"><span class="hs-identifier hs-var">sum</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashMap Text Checksum -&gt; [(Text, Checksum)]
forall k v. HashMap k v -&gt; [(k, v)]
</span><span class="hs-identifier hs-var">HMap.toList</span></span><span> </span><span class="annot"><span class="annottext">HashMap Text Checksum
</span><a href="#local-6989586621679407266"><span class="hs-identifier hs-var">deps</span></a></span><span>
</span><span id="line-223"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-224"></span><span>            </span><span id="local-6989586621679407269"><span class="annot"><span class="annottext">lockSnippet :: (String, (Text, HashMap Text Checksum)) -&gt; Text
</span><a href="#local-6989586621679407269"><span class="hs-identifier hs-var hs-var">lockSnippet</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679407270"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407270"><span class="hs-identifier hs-var">fp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679407272"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407272"><span class="hs-identifier hs-var">nixFP</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="NvFetcher.Types.html#NixExpr"><span class="hs-identifier hs-type">NixExpr</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679407273"><span class="annot"><span class="annottext">HashMap Text Checksum
</span><a href="#local-6989586621679407273"><span class="hs-identifier hs-var">deps</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="annot"><a href="NvFetcher.Types.html#Checksum"><span class="hs-identifier hs-type">Checksum</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-225"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679407274"><span class="annot"><span class="annottext">hashes :: Text
</span><a href="#local-6989586621679407274"><span class="hs-identifier hs-var hs-var">hashes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashMap Text Checksum -&gt; Text
</span><a href="#local-6989586621679407265"><span class="hs-identifier hs-var">depsSnippet</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap Text Checksum
</span><a href="#local-6989586621679407273"><span class="hs-identifier hs-var">deps</span></a></span><span>
</span><span id="line-226"></span><span>               </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="">[trimming|
                    cargoLock.&quot;$fp&quot; = {
                      lockFile = $nixFP;
                      outputHashes = {
                        $hashes
                      };
                    };
                |]</span></span><span>
</span><span id="line-234"></span><span>        </span><span class="annot"><span class="annottext">Text -&gt; Maybe Text
forall a. a -&gt; Maybe a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Maybe Text) -&gt; ([Text] -&gt; Text) -&gt; [Text] -&gt; Maybe Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.unlines</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Maybe Text) -&gt; [Text] -&gt; Maybe Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(String, (Text, HashMap Text Checksum)) -&gt; Text
</span><a href="#local-6989586621679407269"><span class="hs-identifier hs-var">lockSnippet</span></a></span><span> </span><span class="annot"><span class="annottext">((String, (Text, HashMap Text Checksum)) -&gt; Text)
-&gt; [(String, (Text, HashMap Text Checksum))] -&gt; [Text]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">HashMap String (Text, HashMap Text Checksum)
-&gt; [(String, (Text, HashMap Text Checksum))]
forall k v. HashMap k v -&gt; [(k, v)]
</span><span class="hs-identifier hs-var">HMap.toList</span></span><span> </span><span class="annot"><span class="annottext">HashMap String (Text, HashMap Text Checksum)
</span><a href="#local-6989586621679407258"><span class="hs-identifier hs-var">cargoLocks</span></a></span><span>
</span><span id="line-235"></span><span>      </span><span id="local-6989586621679407282"><span class="annot"><span class="annottext">passthru :: Text
</span><a href="#local-6989586621679407282"><span class="hs-identifier hs-var hs-var">passthru</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-236"></span><span>        </span><span class="annot"><span class="annottext">Text
-&gt; (HashMap Text Text -&gt; Text) -&gt; Maybe (HashMap Text Text) -&gt; Text
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span>
</span><span id="line-237"></span><span>          </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-238"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679407283"><span class="annot"><span class="annottext">HashMap Text Text
</span><a href="#local-6989586621679407283"><span class="hs-identifier hs-var">pt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-239"></span><span>              </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.unlines</span></span><span>
</span><span id="line-240"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="NvFetcher.Utils.html#quoteIfNeeds"><span class="hs-identifier hs-var">quoteIfNeeds</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407284"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-241"></span><span>                    </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; = &quot;</span></span><span>
</span><span id="line-242"></span><span>                    </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407285"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-243"></span><span>                    </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;;&quot;</span></span><span>
</span><span id="line-244"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679407284"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407284"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="NvFetcher.Utils.html#quote"><span class="hs-identifier hs-var">quote</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679407285"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407285"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashMap Text Text -&gt; [(Text, Text)]
forall k v. HashMap k v -&gt; [(k, v)]
</span><span class="hs-identifier hs-var">HMap.toList</span></span><span> </span><span class="annot"><span class="annottext">HashMap Text Text
</span><a href="#local-6989586621679407283"><span class="hs-identifier hs-var">pt</span></a></span><span>
</span><span id="line-245"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-246"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-247"></span><span>          </span><span class="annot"><span class="annottext">Maybe (HashMap Text Text)
</span><a href="#local-6989586621679407217"><span class="hs-identifier hs-var">_prpassthru</span></a></span><span>
</span><span id="line-248"></span><span>      </span><span id="local-6989586621679407291"><span class="annot"><span class="annottext">date :: Text
</span><a href="#local-6989586621679407291"><span class="hs-identifier hs-var hs-var">date</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; (Text -&gt; Text) -&gt; Maybe Text -&gt; Text
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679407292"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407292"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;date = &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="NvFetcher.Utils.html#quote"><span class="hs-identifier hs-var">quote</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407292"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679407221"><span class="hs-identifier hs-var">_prgitdate</span></a></span><span>
</span><span id="line-249"></span><span>      </span><span id="local-6989586621679407296"><span class="annot"><span class="annottext">joined :: Text
</span><a href="#local-6989586621679407296"><span class="hs-identifier hs-var hs-var">joined</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407244"><span class="hs-identifier hs-var">extract</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407257"><span class="hs-identifier hs-var">cargo</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407282"><span class="hs-identifier hs-var">passthru</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407291"><span class="hs-identifier hs-var">date</span></a></span><span>
</span><span id="line-250"></span><span>      </span><span id="local-6989586621679407234"><span class="annot"><span class="annottext">appending :: Text
</span><a href="#local-6989586621679407234"><span class="hs-identifier hs-var hs-var">appending</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Bool
</span><span class="hs-identifier hs-var">T.null</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407296"><span class="hs-identifier hs-var">joined</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679407296"><span class="hs-identifier hs-var">joined</span></a></span><span>
</span><span id="line-251"></span></pre></body></html>